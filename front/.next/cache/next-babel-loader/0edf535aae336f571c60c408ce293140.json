{"ast":null,"code":"var __jsx = React.createElement;\nimport React from \"react\";\nimport AppLayout from \"../components/AppLayout\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport PostForm from \"../components/PostForm\";\nimport PostCard from \"../components/PostCard\";\nimport { useEffect } from \"react\";\nimport { LOAD_POSTS_REQUEST } from \"../reducers/post\";\nimport { LOAD_MY_INFO_REQUEST } from \"../reducers/user\";\nimport wrapper from \"../store/configureStore\";\nimport { END } from \"redux-saga\";\nimport axios from \"axios\";\n\nconst Home = () => {\n  const dispatch = useDispatch();\n  const {\n    me\n  } = useSelector(state => state.user);\n  const {\n    retweetError\n  } = useSelector(state => state.post);\n  const {\n    mainPosts,\n    hasMorePosts,\n    loadPostsLoading\n  } = useSelector(state => state.post);\n  useEffect(() => {// dispatch({\n    //   type: LOAD_MY_INFO_REQUEST,\n    // });\n    // dispatch({\n    //   type: LOAD_POSTS_REQUEST,\n    // });\n  }, []);\n  useEffect(() => {\n    if (retweetError) {\n      alert(retweetError);\n    }\n  }, [retweetError]);\n  useEffect(() => {\n    function onScroll() {\n      if (window.scrollY + document.documentElement.clientHeight > document.documentElement.scrollHeight - 300) {\n        if (hasMorePosts && !loadPostsLoading) {\n          var _mainPosts;\n\n          const lastId = (_mainPosts = mainPosts[mainPosts.length - 1]) === null || _mainPosts === void 0 ? void 0 : _mainPosts.id;\n          dispatch({\n            type: LOAD_POSTS_REQUEST,\n            lastId\n          });\n        }\n      }\n    }\n\n    window.addEventListener(\"scroll\", onScroll);\n    return () => {\n      window.removeEventListener(\"scroll\", onScroll);\n    };\n  }, [hasMorePosts, loadPostsLoading, mainPosts]);\n  return __jsx(AppLayout, null, me && __jsx(PostForm, null), mainPosts.map(post => __jsx(PostCard, {\n    key: post.id,\n    post: post\n  })));\n};\n\nexport const getServerSideProps = wrapper.getServerSideProps(async context => {\n  console.log(context);\n  const cookie = context.req ? context.req.headers.cookie : \"\";\n  axios.defaults.headers.Cookie = \"\";\n\n  if (context.req && cookie) {\n    axios.defaults.headers.Cookie = cookie;\n  }\n\n  context.store.dispatch({\n    type: LOAD_MY_INFO_REQUEST\n  });\n  context.store.dispatch({\n    type: LOAD_POSTS_REQUEST\n  });\n  context.store.dispatch(END);\n\n  try {\n    await context.store.sagaTask.toPromise();\n  } catch (error) {\n    console.error(error);\n  }\n});\nexport default Home;","map":{"version":3,"sources":["/Users/huijungyoon/ReactFolder/NodeBirdJS/front/pages/index.js"],"names":["React","AppLayout","useSelector","useDispatch","PostForm","PostCard","useEffect","LOAD_POSTS_REQUEST","LOAD_MY_INFO_REQUEST","wrapper","END","axios","Home","dispatch","me","state","user","retweetError","post","mainPosts","hasMorePosts","loadPostsLoading","alert","onScroll","window","scrollY","document","documentElement","clientHeight","scrollHeight","lastId","length","id","type","addEventListener","removeEventListener","map","getServerSideProps","context","console","log","cookie","req","headers","defaults","Cookie","store","sagaTask","toPromise","error"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport AppLayout from \"../components/AppLayout\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport PostForm from \"../components/PostForm\";\nimport PostCard from \"../components/PostCard\";\nimport { useEffect } from \"react\";\nimport { LOAD_POSTS_REQUEST } from \"../reducers/post\";\nimport { LOAD_MY_INFO_REQUEST } from \"../reducers/user\";\nimport wrapper from \"../store/configureStore\";\nimport { END } from \"redux-saga\";\nimport axios from \"axios\";\nconst Home = () => {\n  const dispatch = useDispatch();\n  const { me } = useSelector((state) => state.user);\n  const { retweetError } = useSelector((state) => state.post);\n  const { mainPosts, hasMorePosts, loadPostsLoading } = useSelector(\n    (state) => state.post\n  );\n\n  useEffect(() => {\n    // dispatch({\n    //   type: LOAD_MY_INFO_REQUEST,\n    // });\n    // dispatch({\n    //   type: LOAD_POSTS_REQUEST,\n    // });\n  }, []);\n\n  useEffect(() => {\n    if (retweetError) {\n      alert(retweetError);\n    }\n  }, [retweetError]);\n\n  useEffect(() => {\n    function onScroll() {\n      if (\n        window.scrollY + document.documentElement.clientHeight >\n        document.documentElement.scrollHeight - 300\n      ) {\n        if (hasMorePosts && !loadPostsLoading) {\n          const lastId = mainPosts[mainPosts.length - 1]?.id;\n\n          dispatch({\n            type: LOAD_POSTS_REQUEST,\n            lastId,\n          });\n        }\n      }\n    }\n    window.addEventListener(\"scroll\", onScroll);\n    return () => {\n      window.removeEventListener(\"scroll\", onScroll);\n    };\n  }, [hasMorePosts, loadPostsLoading, mainPosts]);\n\n  return (\n    <AppLayout>\n      {me && <PostForm />}\n      {mainPosts.map((post) => (\n        <PostCard key={post.id} post={post} />\n      ))}\n    </AppLayout>\n  );\n};\n\nexport const getServerSideProps = wrapper.getServerSideProps(\n  async (context) => {\n    console.log(context);\n    const cookie = context.req ? context.req.headers.cookie : \"\";\n    axios.defaults.headers.Cookie = \"\";\n    if (context.req && cookie) {\n      axios.defaults.headers.Cookie = cookie;\n    }\n    context.store.dispatch({\n      type: LOAD_MY_INFO_REQUEST,\n    });\n    context.store.dispatch({\n      type: LOAD_POSTS_REQUEST,\n    });\n    context.store.dispatch(END);\n    try {\n      await context.store.sagaTask.toPromise();\n    } catch (error) {\n      console.error(error);\n    }\n  }\n);\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}